<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>Unity WebGL Player | 4Photo</title>
    <link rel="shortcut icon" href="TemplateData/favicon.ico">
    <link rel="stylesheet" href="TemplateData/style.css">
    <script src="TemplateData/UnityProgress.js"></script>
    <script src="Build/UnityLoader.js"></script>
    <script>
      var unityInstance = UnityLoader.instantiate("unityContainer", "Build/Build3vk2.json", {onProgress: UnityProgress});
    </script>

    <script type = "text/javascript" language = "javascript">
    var fullscreenID = 'R-A-1324864-1';
    var horizontalbannerID = 'R-A-1324864-2';
    var rewardvideoID = 'R-A-1324864-3';
    var mobilefullscreenID = 'R-A-1324864-4';
    var mobilebannerID = 'R-A-1324864-5';
    var vkfullscreenID = '134976';
    </script>

    <!-- Yandex.RTB -->
    <script>window.yaContextCb=window.yaContextCb||[]</script>
    <script src="https://yandex.ru/ads/system/context.js" async></script>

    <script src="https://vk.com/js/api/xd_connection.js?2"  type="text/javascript"></script>

    <script src="https://unpkg.com/@vkontakte/vk-bridge/dist/browser.min.js"></script>

    <script>vkBridge.send('VKWebAppInit');</script>

  </head>

  <body>
    <div class="webgl-content">

    <div id="unityContainer" style="position:relative; width: 182vh; height: 100vh; max-width: 100vw; max-height: 55vw"></div>

      <!-- Full Screen -->
    <div id="yandex_rtb_R-A-1324864-1" style="position: absolute; top: 16%; width: 182vh; height: 67vh; max-width: 100vw; max-height: 36.85vw"></div>

    <!-- Horizontal Banner -->
    <div id="yandex_rtb_R-A-1324864-2" style="position: absolute; bottom: 0;  width: 182vh; height: 10vh; max-width: 100vw; max-height: 5.5vw"></div>

    <!-- Reward Video -->
    <div id="yandex_rtb_R-A-1324864-3" style="position: absolute; top: 16%; width: 182vh; height: 67vh; max-width: 100vw; max-height: 36.85vw"></div>

    <!-- Mobile Full Screen -->
    <div id="yandex_rtb_R-A-1324864-4" style="position: absolute; top: 16%; width: 182vh; height: 67vh; max-width: 100vw; max-height: 36.85vw"></div>

    <!-- Mobile Banner -->
    <div id="yandex_rtb_R-A-1324864-5" style="position: absolute;  bottom: 0; width: 182vh; height: 10vh; max-width: 100vw; max-height: 5.5vw"></div>

    <!-- VK Full Screen -->
    <div id="vk_ads_134971" style="position: absolute; top: 16%; width: 182vh; height: 67vh; max-width: 100vw; max-height: 36.85vw"></div>

    </div>

    <script type = "text/javascript" language = "javascript">

    function YandexAdsInitialization() {
      document.getElementById('yandex_rtb_' + fullscreenID).style.display = 'none';
      document.getElementById('yandex_rtb_' + mobilefullscreenID).style.display = 'none';
      document.getElementById('yandex_rtb_' + horizontalbannerID).style.display = 'none';
      document.getElementById('yandex_rtb_' + mobilebannerID).style.display = 'none';
      document.getElementById('yandex_rtb_' + rewardvideoID).style.display = 'none';

      unityInstance.SendMessage('AdsManager', 'VerticalInitialization', false);

      document.getElementById('yandex_rtb_' + vkfullscreenID).style.display = 'none';

      VK.init(function() {
      }, function() {
        VKAdsInitialization();
      }, '5.131');
    }

    function ShowFullScreen() {
      bridge.send("VKWebAppShowNativeAds", {ad_format:"preloader"})
      .then(data =>{})
      .catch(error =>{
        bridge.send("VKWebAppShowNativeAds", {ad_format:"interstitial"})
        .then(data =>{})
        .catch(error =>{
          ShowYandexFullScreen();
        });
      });
    }

    function ShowYandexFullScreen() {
      document.getElementById('yandex_rtb_' + fullscreenID).style.display = 'block';
      Ya.Context.AdvManager.render({
        renderTo: 'yandex_rtb_' + fullscreenID,
        blockId: fullscreenID,
        onError: (data) => {
          CloseFullScreen();
        },
        onRender: (data) => {
          unityInstance.SendMessage('AdsManager', 'FullScreenShowed');
        }
      })
    }

    function ShowVKFullScreen() {
      document.getElementById('yandex_rtb_' + vkfullscreenID).style.display = 'block';

      setTimeout(function() {
        var adsParams = {"ad_unit_id":vkfullscreenID,"ad_unit_hash":"e366863fa5f7c9579d440113ddfcae41"};
        function vkAdsInit() {
          VK.Widgets.Ads('vk_ads_' + vkfullscreenID, {}, adsParams);
        }
        if (window.VK && VK.Widgets) {
          vkAdsInit();
        } else {
          if (!window.vkAsyncInitCallbacks) window.vkAsyncInitCallbacks = [];
          vkAsyncInitCallbacks.push(vkAdsInit);
          var protocol = ((location.protocol === 'https:') ? 'https:' : 'http:');
          var adsElem = document.getElementById('vk_ads_' + vkfullscreenID);
          var scriptElem = document.createElement('script');
          scriptElem.type = 'text/javascript';
          scriptElem.async = true;
          scriptElem.src = protocol + '//vk.com/js/api/openapi.js?169';
          adsElem.parentNode.insertBefore(scriptElem, adsElem.nextSibling);
        }
      }, 0);
    }

    function ShowMobileFullScreen() {
      bridge.send("VKWebAppShowNativeAds", {ad_format:"preloader"})
      .then(data =>{})
      .catch(error =>{
        bridge.send("VKWebAppShowNativeAds", {ad_format:"interstitial"})
        .then(data =>{})
        .catch(error =>{
          ShowYandexMobileFullScreen();
        });
      });
    }

    function ShowYandexMobileFullScreen() {
      document.getElementById('yandex_rtb_' + mobilefullscreenID).style.display = 'block';
      Ya.Context.AdvManager.render({
        renderTo: 'yandex_rtb_' + mobilefullscreenID,
        blockId: mobilefullscreenID,
        onError: (data) => {
          CloseMobileFullScreen();
          ShowVKFullScreen();
        },
        onRender: (data) => {
          unityInstance.SendMessage('AdsManager', 'FullScreenShowed');
        }
      })
    }

    function CloseFullScreen() {
      document.getElementById('yandex_rtb_' + fullscreenID).style.display = 'none';
      document.getElementById('yandex_rtb_' + vkfullscreenID).style.display = 'none';
    }

    function CloseVKFullScreen() {
      document.getElementById('yandex_rtb_' + vkfullscreenID).style.display = 'none';
    }

    function VKFullScreenShowed() {
      unityInstance.SendMessage('AdsManager', 'FullScreenShowed');
    }

    function ShowBanner() {
      document.getElementById('yandex_rtb_' + horizontalbannerID).style.display = 'block';
      Ya.Context.AdvManager.render({
        renderTo: 'yandex_rtb_' + horizontalbannerID,
        blockId: horizontalbannerID
        onError: (data) => {
          CloseBanner();
        }
      })
    }

    function ShowMobileBanner() {
      document.getElementById('yandex_rtb_' + mobilebannerID).style.display = 'block';
      Ya.Context.AdvManager.render({
        renderTo: 'yandex_rtb_' + mobilebannerID,
        blockId: mobilebannerID
        onError: (data) => {
          CloseMobileBanner();
        }
      })
    }

    function CloseBanner() {
      document.getElementById('yandex_rtb_' + horizontalbannerID).style.display = 'none';
    }

    function CloseMobileBanner() {
      document.getElementById('yandex_rtb_' + mobilebannerID).style.display = 'none';
    }

    function ShowRewardVideo() {
      bridge.send("VKWebAppShowNativeAds", {ad_format:"reward"})
      .then(data =>{})
      .catch(error =>{
        ShowYandexRewardVideo();
      });
    }

    function ShowYandexRewardVideo() {
      document.getElementById('yandex_rtb_' + rewardvideoID).style.display = 'block';
      Ya.Context.AdvManager.render({
        renderTo: 'yandex_rtb_' + rewardvideoID,
        blockId: rewardvideoID,
        onError: (data) => {
        console.log('type', data.type); // Тип ошибки: error или warning
        CloseFullScreen();
      },
        onRender: (data) => {
          console.log(data.product);
          unityInstance.SendMessage('AdsManager', 'RewardVideoShowed');
        }
      })
    }

    function CloseRewardVideo() {
      document.getElementById('yandex_rtb_' + rewardvideoID).style.display = 'none';
    }

  </script>
  </body>
</html>
